name: GitHub CI

on:
  pull_request:
  workflow_dispatch:
    inputs:
      revn:
        type: choice
        options:
        - '251'
        - '242'
        - '241'
        description: 'The Mechanical revision number to run tests on.'
        default: '242' #stable version is 242, must match $stable_container
  schedule:
    - cron: '00 22 * * *'  # UTC time, may start 5-15 mins later than scheduled time
  # registry_package:
    # Run workflow when package is published or updated
    # types: [published]
  push:
    tags:
      - "*"
    branches:
      - main
      - release/*



env:
  PYMECHANICAL_PORT: 10000  # default won't work on GitHub runners
  PYMECHANICAL_START_INSTANCE: false
  DOCKER_PACKAGE: ghcr.io/ansys/mechanical
  DOCKER_MECH_CONTAINER_NAME: mechanical
  PACKAGE_NAME: ansys-mechanical-core
  DOCUMENTATION_CNAME: mechanical.docs.pyansys.com
  MAIN_PYTHON_VERSION: '3.11'
  # DEV_REVN & its Docker image are used in scheduled or registry package runs
  DEV_REVN: '251'
  DEV_DOCKER_IMAGE_VERSION: '25.1_candidate'
  LICENSE_SERVER: ${{ secrets.LICENSE_SERVER }}
  ANSYSLMD_LICENSE_FILE: 1055@${{ secrets.LICENSE_SERVER }}

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  check-vulnerabilities:
    name: "Check library vulnerabilities (development mode)"
    if: github.ref != 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
      - name: "Check library vulnerabilities with development mode"
        uses: ansys/actions/check-vulnerabilities@v8.0
        with:
          python-version: ${{ env.MAIN_PYTHON_VERSION }}
          token: ${{ secrets.PYANSYS_CI_BOT_TOKEN }}
          python-package-name: 'ansys-mechanical-core'
          dev-mode: true